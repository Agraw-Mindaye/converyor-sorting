<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://www.plcopen.org/xml/tc6_0200">
  <fileHeader companyName="" productName="CODESYS" productVersion="CODESYS V3.5 SP21 Patch 4" creationDateTime="2026-02-16T18:16:44.354395" />
  <contentHeader name="Conveyor_Sorting.project" modificationDateTime="2026-02-16T17:52:49.6594092">
    <coordinateInfo>
      <fbd>
        <scaling x="1" y="1" />
      </fbd>
      <ld>
        <scaling x="1" y="1" />
      </ld>
      <sfc>
        <scaling x="1" y="1" />
      </sfc>
    </coordinateInfo>
    <addData>
      <data name="http://www.3s-software.com/plcopenxml/projectinformation" handleUnknown="implementation">
        <ProjectInformation />
      </data>
    </addData>
  </contentHeader>
  <types>
    <dataTypes />
    <pous />
  </types>
  <instances>
    <configurations>
      <configuration name="Device">
        <resource name="Application">
          <task name="MainTask" interval="PT0.02S" priority="1">
            <pouInstance name="PLC_PRG" typeName="">
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml" />
              </documentation>
            </pouInstance>
            <addData>
              <data name="http://www.3s-software.com/plcopenxml/tasksettings" handleUnknown="implementation">
                <TaskSettings KindOfTask="Cyclic" Interval="t#20ms" IntervalUnit="ms" WithinSPSTimeSlicing="true">
                  <Watchdog Enabled="false" TimeUnit="ms" Sensitivity="1" />
                </TaskSettings>
              </data>
              <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
                <ObjectId>6ae3412f-08c5-474f-97cf-773a58b7e9ab</ObjectId>
              </data>
            </addData>
          </task>
          <globalVars name="GVL_System">
            <variable name="State">
              <type>
                <derived name="E_SystemState" />
              </type>
              <initialValue>
                <simpleValue value="STOPPED" />
              </initialValue>
            </variable>
            <variable name="NextState">
              <type>
                <derived name="E_SystemState" />
              </type>
              <initialValue>
                <simpleValue value="STOPPED" />
              </initialValue>
            </variable>
            <variable name="RouteToA">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> latched route for current item </xhtml>
              </documentation>
            </variable>
            <variable name="RouteLatched">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> true once route is captured </xhtml>
              </documentation>
            </variable>
            <variable name="FaultLatched">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="Prev_PE_Clear">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> for edge detect </xhtml>
              </documentation>
            </variable>
            <addData>
              <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                <Attributes>
                  <Attribute Name="qualified_only" Value="" />
                </Attributes>
              </data>
              <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
                <ObjectId>2e6d7abe-d60d-49db-8657-881c082d5d96</ObjectId>
              </data>
            </addData>
          </globalVars>
          <globalVars name="GVL_IO">
            <variable name="PB_START">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> Inputs </xhtml>
              </documentation>
            </variable>
            <variable name="PB_STOP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PB_RESET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E_STOP_OK">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="PE_INFEED">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PE_CLEAR">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> often 'clear' is TRUE when not blocked </xhtml>
              </documentation>
            </variable>
            <variable name="ITEM_TYPE_A">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> TRUE = route to Tray A </xhtml>
              </documentation>
            </variable>
            <variable name="TRAY_A_EMPTY">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="TRAY_B_EMPTY">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="MTR_RUN">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> Outputs </xhtml>
              </documentation>
            </variable>
            <variable name="DIVERT_TO_A">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DIVERT_TO_B">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ALARM">
              <type>
                <BOOL />
              </type>
            </variable>
            <addData>
              <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                <Attributes>
                  <Attribute Name="qualified_only" Value="" />
                </Attributes>
              </data>
              <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
                <ObjectId>7f61c728-807e-4d08-b832-c17e44288c80</ObjectId>
              </data>
            </addData>
          </globalVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/datatype" handleUnknown="implementation">
              <dataType name="E_SystemState">
                <baseType>
                  <enum>
                    <values>
                      <value name="STOPPED" />
                      <value name="IDLE_READY" />
                      <value name="WAIT_TRAY_EMPTY" />
                      <value name="TRANSFER" />
                      <value name="FAULT" />
                    </values>
                  </enum>
                </baseType>
                <addData>
                  <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
                    <ObjectId>5785c622-6a33-4129-aa06-e4e481062f7b</ObjectId>
                  </data>
                </addData>
              </dataType>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/pou" handleUnknown="implementation">
              <pou name="PLC_PRG" pouType="program">
                <interface>
                  <localVars>
                    <variable name="clear_rise">
                      <type>
                        <BOOL />
                      </type>
                    </variable>
                  </localVars>
                </interface>
                <body>
                  <ST>
                    <xhtml xmlns="http://www.w3.org/1999/xhtml">(* Default: remain in current state *)
GVL_System.NextState := GVL_System.State;

(* Rising edge when PE_CLEAR goes from 0 -&gt; 1 (blocked -&gt; clear) *)
clear_rise := (NOT GVL_System.Prev_PE_Clear) AND (GVL_IO.PE_CLEAR);
GVL_System.Prev_PE_Clear := GVL_IO.PE_CLEAR;

(* Default outputs: safe *)
GVL_IO.MTR_RUN := FALSE;
GVL_IO.DIVERT_TO_A := FALSE;
GVL_IO.DIVERT_TO_B := FALSE;
GVL_IO.ALARM := FALSE;

(* E-stop fault: immediate, latched *)
IF NOT GVL_IO.E_STOP_OK THEN
    GVL_System.FaultLatched := TRUE;
    GVL_System.State := FAULT;
    RETURN;
END_IF;

CASE GVL_System.State OF

STOPPED:
    (* System is safe, waiting for start *)
	
	GVL_System.RouteLatched := FALSE;
	
    IF GVL_IO.PB_START AND NOT GVL_System.FaultLatched THEN
        GVL_System.NextState := IDLE_READY;
    END_IF;

IDLE_READY:
    (* waiting for item *)
    IF GVL_IO.PE_INFEED THEN
        GVL_System.NextState := WAIT_TRAY_EMPTY;
    END_IF;

WAIT_TRAY_EMPTY:
    (* Latch route once per item *)
    IF NOT GVL_System.RouteLatched THEN
        GVL_System.RouteToA := GVL_IO.ITEM_TYPE_A;   (* TRUE=A, FALSE=B *)
        GVL_System.RouteLatched := TRUE;
    END_IF;

    (* Wait until destination tray is empty *)
    IF GVL_System.RouteToA THEN
        (* Route A *)
        IF GVL_IO.TRAY_A_EMPTY THEN
            GVL_System.NextState := TRANSFER;
        END_IF;
    ELSE
        (* Route B *)
        IF GVL_IO.TRAY_B_EMPTY THEN
            GVL_System.NextState := TRANSFER;
        END_IF;
    END_IF;

TRANSFER:
    (* Command diverter to latched route *)
    IF GVL_System.RouteToA THEN
        GVL_IO.DIVERT_TO_A := TRUE;
    ELSE
        GVL_IO.DIVERT_TO_B := TRUE;
    END_IF;

    (* Run conveyor *)
    GVL_IO.MTR_RUN := TRUE;

    (* Stop transfer when item clears the zone *)
    IF clear_rise THEN
        GVL_IO.MTR_RUN := FALSE;
        GVL_System.RouteLatched := FALSE;     (* ready for next item *)
        GVL_System.NextState := IDLE_READY;
    END_IF;

FAULT:
    GVL_IO.ALARM := TRUE;
    IF GVL_IO.PB_RESET AND GVL_IO.E_STOP_OK THEN
        GVL_System.FaultLatched := FALSE;
        GVL_System.RouteLatched := FALSE;
        GVL_System.NextState := STOPPED;
    END_IF;

END_CASE;

(* State update *)
GVL_System.State := GVL_System.NextState;



</xhtml>
                  </ST>
                </body>
                <addData>
                  <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
                    <ObjectId>42051e77-eb9c-4062-9771-3e6f6f64e828</ObjectId>
                  </data>
                </addData>
              </pou>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/libraries" handleUnknown="implementation">
              <Libraries>
                <Library Name="#IoStandard" Namespace="IoStandard" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="true" DefaultResolution="IoStandard, 3.5.17.0 (System)" />
                <Library Name="#3SLicense" Namespace="_3S_LICENSE" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="3SLicense, 0.0.0.0 (CODESYS)" ResolverGuid="97c3b452-d9fa-4ac2-9d0c-3d420aa6d95b" />
                <Library Name="#CAA Device Diagnosis" Namespace="DED" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="CAA Device Diagnosis, 3.5.21.0 (CAA Technical Workgroup)" />
                <Library Name="#Standard" Namespace="Standard" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="Standard, * (System)" />
                <Library Name="#BreakpointLogging" Namespace="BPLog" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="Breakpoint Logging Functions, * (3S - Smart Software Solutions GmbH)" />
                <PlaceholderRedirections>
                  <PlaceholderRedirection Placeholder="Standard" Redirection="Standard, 3.5.18.0 (System)" />
                </PlaceholderRedirections>
                <addData>
                  <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
                    <ObjectId>3edbe7b3-e3b1-4d3c-a110-7f049fde3608</ObjectId>
                  </data>
                </addData>
              </Libraries>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
              <ObjectId>935e178e-1c7a-4355-bccd-0f1e795acc34</ObjectId>
            </data>
          </addData>
        </resource>
        <addData>
          <data name="Device" handleUnknown="discard">
            <Device xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="">
              <DeviceType>
                <DeviceIdentification>
                  <Type>4096</Type>
                  <Id>0000 0004</Id>
                  <Version>3.5.21.40</Version>
                </DeviceIdentification>
                <Connector moduleType="256" interface="Common.PCI" connectorId="0">
                  <HostParameterSet />
                </Connector>
                <Connector moduleType="769" interface="SafetyInterface" connectorId="1">
                  <HostParameterSet />
                </Connector>
                <DeviceParameterSet />
              </DeviceType>
            </Device>
          </data>
          <data name="configurations" handleUnknown="discard">
            <configurations />
          </data>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8f7efc99-6115-4025-8793-db1bc5dc1e67</ObjectId>
          </data>
        </addData>
      </configuration>
    </configurations>
  </instances>
  <addData>
    <data name="http://www.3s-software.com/plcopenxml/projectstructure" handleUnknown="discard">
      <ProjectStructure>
        <Object Name="Device" ObjectId="8f7efc99-6115-4025-8793-db1bc5dc1e67">
          <Object Name="Application" ObjectId="935e178e-1c7a-4355-bccd-0f1e795acc34">
            <Object Name="Library Manager" ObjectId="3edbe7b3-e3b1-4d3c-a110-7f049fde3608" />
            <Object Name="PLC_PRG" ObjectId="42051e77-eb9c-4062-9771-3e6f6f64e828" />
            <Object Name="MainTask" ObjectId="6ae3412f-08c5-474f-97cf-773a58b7e9ab" />
            <Object Name="GVL_System" ObjectId="2e6d7abe-d60d-49db-8657-881c082d5d96" />
            <Object Name="E_SystemState" ObjectId="5785c622-6a33-4129-aa06-e4e481062f7b" />
            <Object Name="GVL_IO" ObjectId="7f61c728-807e-4d08-b832-c17e44288c80" />
          </Object>
        </Object>
      </ProjectStructure>
    </data>
  </addData>
</project>